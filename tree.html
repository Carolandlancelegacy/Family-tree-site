<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Family Tree Viewer</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      margin: 0;
      overflow: hidden;
      background: #fdfaf6;
    }
    .node rect {
      fill: white;
      stroke: #333;
      stroke-width: 1.5px;
      rx: 6;
      ry: 6;
    }
    .node.spouse rect {
      fill: #f8f8f8;
      stroke: #999;
    }
    .node text {
      font-size: 12px;
      pointer-events: none;
    }
    .link {
      fill: none;
      stroke: #ccc;
      stroke-width: 1.5px;
    }
  </style>
</head>
<body>

<script src="https://d3js.org/d3.v7.min.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function () {
  const width = window.innerWidth;
  const height = window.innerHeight;

  const svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height)
    .call(d3.zoom().on("zoom", (event) => {
      g.attr("transform", event.transform);
    }));

  const g = svg.append("g").attr("transform", `translate(${width / 2}, 100)`);

  const treeData = {
    "name": "Carol Sheen (deceased)",
    "marriages": [
      { "spouse": "Lance" }
    ],
    "children": [
      {
        "name": "Patrick Sheen",
        "marriages": [
          {
            "spouse": "Kathleen (divorced)",
            "divorced": true,
            "children": [
              { "name": "Myf (daughter, first marriage)" }
            ]
          },
          {
            "spouse": "Suzi (current wife)",
            "children": [
              { "name": "Rebecca (stepdaughter, Suzi's child)" },
              { "name": "[Son] (Suzi's child)" }
            ]
          }
        ]
      },
      {
        "name": "Elizabeth (Libby) O'Neill",
        "widowed": true,
        "marriages": [
          {
            "spouse": "Pat (deceased)",
            "children": [
              {
                "name": "Caroline (married to Alex)",
                "marriages": [
                  {
                    "spouse": "Alex",
                    "children": [
                      { "name": "Edith" },
                      { "name": "Patrick" }
                    ]
                  }
                ]
              },
              { "name": "Colleen" },
              { "name": "Phillip" }
            ]
          }
        ]
      },
      {
        "name": "Martin Sheen",
        "marriages": [
          {
            "spouse": "Tracy",
            "children": [
              { "name": "Anthony (oldest brother)" },
              { "name": "Ben (You)" },
              { "name": "Emma (sister, deceased)" },
              { "name": "Jordan (youngest sister)" }
            ]
          }
        ]
      },
      {
        "name": "Andrew Sheen",
        "marriages": [
          {
            "spouse": "Dennis (divorced)",
            "divorced": true,
            "children": [
              { "name": "Zanesha" }
            ]
          }
        ]
      },
      {
        "name": "Joanne Sheen",
        "marriages": [
          {
            "spouse": "Greg"
          }
        ]
      }
    ]
  };

  function flattenTree(data) {
    const clone = JSON.parse(JSON.stringify(data));

    function expandMarriages(person) {
      if (person.marriages) {
        person.marriages.forEach(m => {
          const spouseNode = {
            name: m.spouse,
            spouse: true,
            _linkTo: person.name
          };
          if (!person.children) person.children = [];
          person.children.push(spouseNode);

          if (m.children) {
            person.children = person.children.concat(m.children);
          }
        });
      }

      if (person.children) {
        person.children.forEach(child => expandMarriages(child));
      }
    }

    expandMarriages(clone);
    return clone;
  }

  const flatData = flattenTree(treeData);

  const root = d3.hierarchy(flatData);

  const treeLayout = d3.tree().nodeSize([180, 120]);
  treeLayout(root);

  g.selectAll(".link")
    .data(root.links())
    .enter().append("path")
    .attr("class", "link")
    .attr("d", d3.linkVertical()
      .x(d => d.x)
      .y(d => d.y))
    .attr("stroke", d => {
      const isDivorced = (d.source.data.divorced || d.target.data.divorced);
      return isDivorced ? "#999" : "#ccc";
    })
    .attr("stroke-dasharray", d => {
      const isDivorced = (d.source.data.divorced || d.target.data.divorced);
      return isDivorced ? "4 2" : null;
    });

  const node = g.selectAll(".node")
    .data(root.descendants())
    .enter().append("g")
    .attr("class", d => d.data.spouse ? "node spouse" : "node")
    .attr("transform", d => `translate(${d.x},${d.y})`);

  node.each(function (d)
